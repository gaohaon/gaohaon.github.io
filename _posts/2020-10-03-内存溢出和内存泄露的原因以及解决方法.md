---
layout: post
title: 内存溢出和内存泄露的原因以及解决方法
date: 2020-12-02 11:15:06 
tag: JVM 
---

### 什么是内存泄露和内存溢出？
内存泄露：程序无法释放已经申请的内存空间，造成内存泄露。
内存溢出：申请空间时，没有足够的空间供申请者使用。
内存泄露多次，会造成内存溢出。
### 内存泄露的原因？
1. 内存泄露其实就是java虚拟机无法回收**无用**的对象（工具类），这些对象可能被正在使用的对象所引用，所以尽量将这些对象独立出来，或者变成静态类。
2. 一些资源性对象在使用之后尽量使用close进行关闭。（input  output数据流）
3. 在集合（List Map）使用过程中，我们通常将引用的对象存储在容器中，当我们不在需要这些对象的时候，需要将集合里的对象进行clear 然后赋值为null。如果不clear 那么这个集合将会越来越大。

### 内存泄露的解决方法？

1. 对于不在使用的对象赋值为null
2. 将内部类 变成静态内部类 

### 内存溢出的原因？

1. 内存中加载的数据量过于庞大，比如一次性从数据库加载过多的数据。
2. 死循环、或者循环过多，不断的创建实体对象。
3. 死循环和递归调用 
4. 程序的内存参数值设置过小。 

### 内存溢出的解决方法?

1. JVM设置大点内存（-Xxm -Xxs）(修改JVM参数)
2. 检查错误日志，查看OOM（Out Of Memory）错误前是否有其他的异常
3. 对代码进行review 找出会发生内存溢出的点
4. 导出hprof文件，到mat分析工具进行分析 

### 内存溢出重点排查的点？

1. 数据库是否一次性获得全部的数据。因此对于数据库查询尽量采用分页的方式进行查询。 
2. 死循环或者是递归调用
3. 循环重复创建实体
4. 一些存储引用对象的集合要及时的进行clear和赋值为null。
